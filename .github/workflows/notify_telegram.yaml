name: Notify Telegram on HTML Changes

on:
  push:
    branches:
      - main
    paths:
      - 'html/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Obtener cambios recientes
        id: changes
        run: |
          CHANGED_FILES=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} -- html/)
          if [[ -z "$CHANGED_FILES" ]]; then
            echo "No hay cambios en el directorio html/"
            exit 0
          fi
          echo "CHANGED_FILES=$CHANGED_FILES" >> $GITHUB_ENV

      - name: Notificar por Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          MESSAGE="*ActualizaciÃ³n en CrazyOnes* Se han actualizado los siguientes archivos en el directorio *html/*:%0A\`\`\`$CHANGED_FILES\`\`\`%0AðŸ”— [Ver cambios](https://github.com/${{ github.repository }}/commits/main)"
          
          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
          -d "chat_id=$TELEGRAM_CHAT_ID" \
          -d "parse_mode=Markdown" \
          -d "text=$MESSAGE"
